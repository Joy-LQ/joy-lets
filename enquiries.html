<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=375px, initial-scale=1.0">
  <title>Enquiries ¬∑ Joy Lets</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    .enq-header {
      padding: 20px 24px 8px;
    }
    .enq-header-title {
      font-size: 22px;
      font-weight: 700;
      color: var(--neutral-100);
    }
    .enq-header-sub {
      font-size: 14px;
      color: var(--neutral-70);
      margin-top: 4px;
    }
    .enq-form {
      padding: 16px 24px 120px;
    }
    .enq-label {
      font-size: 13px;
      font-weight: 500;
      color: var(--neutral-80);
      margin-bottom: 6px;
      display: block;
    }
    .enq-input, .enq-select, .enq-textarea {
      width: 100%;
      border: 1.5px solid var(--neutral-40);
      border-radius: 10px;
      padding: 12px 14px;
      font-size: 14px;
      font-family: inherit;
      outline: none;
      background: white;
      box-sizing: border-box;
      margin-bottom: 16px;
    }
    .enq-input:focus, .enq-select:focus, .enq-textarea:focus {
      border-color: var(--neutral-100);
    }
    .enq-textarea { height: 100px; resize: none; }
    .enq-submit {
      width: 100%;
      background: var(--neutral-100);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 16px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
    }
    .enq-submit:disabled { opacity: 0.5; cursor: not-allowed; }
    .enq-success {
      text-align: center;
      padding: 60px 24px;
      display: none;
    }
    .enq-success-icon { font-size: 48px; margin-bottom: 16px; }
    .enq-success-title { font-size: 20px; font-weight: 700; margin-bottom: 8px; }
    .enq-success-sub { font-size: 14px; color: var(--neutral-70); line-height: 22px; }
  </style>
</head>
<body>
<div class="app">

  <div class="status-bar">
    <span class="time" id="clock">9:41</span>
    <span class="icons">‚ñ≤ WiFi üîã</span>
  </div>

  <div class="page-header">
    <span class="page-title">Enquiries</span>
  </div>

  <!-- Form -->
  <div id="enq-form-section">
    <div class="enq-header">
      <div class="enq-header-title">Get in Touch</div>
      <div class="enq-header-sub">We'll get back to you within 24 hours.</div>
    </div>

    <div class="enq-form">
      <label class="enq-label">Your Name *</label>
      <input class="enq-input" id="eq-name" type="text" placeholder="Full name">

      <label class="enq-label">Phone Number *</label>
      <input class="enq-input" id="eq-phone" type="tel" placeholder="+44 7700 000000">

      <label class="enq-label">Email Address *</label>
      <input class="enq-input" id="eq-email" type="email" placeholder="your@email.com">

      <label class="enq-label">Property of Interest</label>
      <select class="enq-select" id="eq-property">
        <option value="">Any / Not sure yet</option>
      </select>

      <label class="enq-label">Move-in Date</label>
      <input class="enq-input" id="eq-movein" type="date">

      <label class="enq-label">Lease Length</label>
      <select class="enq-select" id="eq-lease">
        <option value="">Not decided</option>
        <option value="10 months">10 Months</option>
        <option value="12 months">12 Months</option>
      </select>

      <label class="enq-label">Message</label>
      <textarea class="enq-textarea" id="eq-msg" placeholder="Any questions or preferred viewing times?"></textarea>

      <button class="enq-submit" id="enq-submit-btn" onclick="sendEnquiry()">Send Enquiry</button>
    </div>
  </div>

  <!-- Success -->
  <div class="enq-success" id="enq-success">
    <div class="enq-success-icon">‚úÖ</div>
    <div class="enq-success-title">Enquiry Sent!</div>
    <div class="enq-success-sub">Thank you! We'll be in touch within 24 hours.<br><br>In the meantime, feel free to browse more properties or message us on WhatsApp.</div>
    <br>
    <button class="enq-submit" onclick="window.open('https://wa.me/447510757408','_blank')" style="margin-top:8px;background:var(--primary)">
      üí¨ WhatsApp Us
    </button>
  </div>

  <!-- Bottom Nav -->
  <nav class="bottom-nav">
    <a class="nav-item" href="index.html">
      <span class="nav-icon">üîç</span>
      <span class="nav-label">Browse</span>
    </a>
    <a class="nav-item" href="saved.html">
      <span class="nav-icon">ü§ç</span>
      <span class="nav-label">Shortlist</span>
    </a>
    <a class="nav-item active" href="enquiries.html">
      <span class="nav-icon">üìã</span>
      <span class="nav-label">Enquiries</span>
    </a>
    <a class="nav-item" href="#" onclick="openContactSheet()">
      <span class="nav-icon">üí¨</span>
      <span class="nav-label">Messages</span>
    </a>
    <a class="nav-item" href="profile.html">
      <span class="nav-icon">üë§</span>
      <span class="nav-label">Profile</span>
    </a>
  </nav>
</div>

<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
  emailjs.init('JoFzXM3DWJN7pxWnk');

  function updateClock() {
    const now = new Date();
    document.getElementById('clock').textContent =
      now.getHours() + ':' + String(now.getMinutes()).padStart(2,'0');
  }
  updateClock();

  // Populate property dropdown from listings.json
  fetch('data/listings.json')
    .then(r => r.json())
    .then(data => {
      const sel = document.getElementById('eq-property');
      data.listings.forEach(l => {
        const opt = document.createElement('option');
        opt.value = l.title;
        opt.textContent = l.title + ' ¬∑ ¬£' + l.price.toLocaleString() + '/mo';
        sel.appendChild(opt);
      });
    });

  // Pre-fill from URL param (if coming from a listing page)
  const urlId = new URLSearchParams(location.search).get('property');
  if (urlId) {
    fetch('data/listings.json').then(r => r.json()).then(data => {
      const l = data.listings.find(x => x.id === urlId);
      if (l) document.getElementById('eq-property').value = l.title;
    });
  }

  async function sendEnquiry() {
    const name = document.getElementById('eq-name').value.trim();
    const phone = document.getElementById('eq-phone').value.trim();
    const email = document.getElementById('eq-email').value.trim();
    const property = document.getElementById('eq-property').value;
    const movein = document.getElementById('eq-movein').value;
    const lease = document.getElementById('eq-lease').value;
    const msg = document.getElementById('eq-msg').value.trim();

    if (!name || !phone || !email) {
      alert('Please fill in your name, phone, and email.');
      return;
    }

    const btn = document.getElementById('enq-submit-btn');
    btn.disabled = true;
    btn.textContent = 'Sending...';

    try {
      await emailjs.send('service_5onxiwg', 'template_besuj5b', {
        name: name,
        phone: phone,
        email: email,
        title: property || 'Not specified',
        move_in: movein || 'Not specified',
        lease: lease || 'Not specified',
        message: msg || '‚Äî'
      });

      document.getElementById('enq-form-section').style.display = 'none';
      document.getElementById('enq-success').style.display = 'block';
    } catch (err) {
      alert('Sorry, something went wrong. Please try WhatsApp instead.');
      btn.disabled = false;
      btn.textContent = 'Send Enquiry';
    }
  }
</script>
<script src="js/contact.js"></script>
</body>
</html>
